---
name: 环境检测引擎
status: open
created: 2025-09-16T19:12:48Z
updated: 2025-09-16T19:12:48Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: 环境检测引擎

## Description
实现系统环境自动检测功能，包括Shell环境检测（PowerShell/Git Bash）、AI工具安装检测和版本验证。根据检测结果制定优先级策略，为后续配置管理提供准确的环境信息。

## Acceptance Criteria
- [ ] 检测PowerShell版本和安装路径（5.1+和Core 7+）
- [ ] 检测Git Bash安装状态和版本
- [ ] 实现Shell环境优先级选择逻辑（PowerShell > Git Bash）
- [ ] 检测Claude Code CLI安装和版本兼容性
- [ ] 检测OpenAI Codex CLI安装和配置状态
- [ ] 创建环境检测报告和建议
- [ ] 实现环境检测缓存机制
- [ ] 添加环境变化监控和通知

## Technical Details
- **检测方法**:
  - 注册表查询（PowerShell路径）
  - PATH环境变量扫描
  - 文件系统检查（常见安装路径）
  - 命令行可用性测试
- **关键类**: `EnvironmentDetector`, `ShellDetector`, `AIToolDetector`
- **检测策略**:
  - PowerShell: 检查 `$PSVersionTable` 输出
  - Git Bash: 检查 `git --version` 和 `bash --version`
  - AI工具: 执行 `--version` 命令验证

## Dependencies
- [ ] Windows注册表访问权限
- [ ] 进程执行权限（用于版本检测）
- [ ] 任务001（项目基础架构）完成

## Effort Estimate
- Size: M
- Hours: 20小时
- Parallel: true（可与认证系统并行开发）

## Definition of Done
- [ ] 所有目标环境检测功能正常
- [ ] 检测结果准确率达到100%
- [ ] 检测性能 < 2秒（完整扫描）
- [ ] 环境变化监控机制工作正常
- [ ] 异常环境处理和用户提示完善
- [ ] 单元测试覆盖所有检测场景
- [ ] 检测报告格式清晰易懂