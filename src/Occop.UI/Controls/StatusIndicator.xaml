<UserControl x:Class="Occop.UI.Controls.StatusIndicator"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Occop.UI.Controls"
             mc:Ignorable="d"
             d:DesignHeight="60" d:DesignWidth="300">

    <UserControl.Resources>
        <!-- 状态指示器样式 -->
        <Style x:Key="StatusIconStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="StatusTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="StatusMessageStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#7F8C8D"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,2,0,0"/>
        </Style>

        <Style x:Key="StatusDetailsStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#95A5A6"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,1,0,0"/>
        </Style>

        <!-- 加载动画样式 -->
        <Style x:Key="LoadingEllipseStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="4"/>
            <Setter Property="Height" Value="4"/>
            <Setter Property="Fill" Value="#3498DB"/>
            <Setter Property="Margin" Value="1"/>
        </Style>

        <!-- 加载动画 -->
        <Storyboard x:Key="LoadingAnimation" RepeatBehavior="Forever">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="LoadingDot1" Storyboard.TargetProperty="Opacity">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:1.2" Value="0.3"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="LoadingDot2" Storyboard.TargetProperty="Opacity">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:1.2" Value="0.3"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="LoadingDot3" Storyboard.TargetProperty="Opacity">
                <EasingDoubleKeyFrame KeyTime="0:0:0" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.4" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="1"/>
                <EasingDoubleKeyFrame KeyTime="0:0:0.8" Value="0.3"/>
                <EasingDoubleKeyFrame KeyTime="0:0:1.2" Value="0.3"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <UserControl.Triggers>
        <DataTrigger Binding="{Binding IsLoading}" Value="True">
            <DataTrigger.EnterActions>
                <BeginStoryboard Storyboard="{StaticResource LoadingAnimation}"/>
            </DataTrigger.EnterActions>
            <DataTrigger.ExitActions>
                <StopStoryboard Storyboard="{StaticResource LoadingAnimation}"/>
            </DataTrigger.ExitActions>
        </DataTrigger>
    </UserControl.Triggers>

    <Border Background="Transparent"
            BorderBrush="{Binding BorderBrush}"
            BorderThickness="{Binding BorderThickness}"
            CornerRadius="4"
            Padding="12,8">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 状态图标区域 -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <!-- 普通状态图标 -->
                <Ellipse x:Name="StatusIcon"
                         Style="{StaticResource StatusIconStyle}"
                         Fill="{Binding StatusColor}"
                         Visibility="{Binding LoadingIconVisibility, Converter={x:Static local:StatusIndicator.InvertedBooleanToVisibilityConverter}}"/>

                <!-- 加载状态图标 -->
                <StackPanel x:Name="LoadingIcon"
                           Orientation="Horizontal"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"
                           Visibility="{Binding LoadingIconVisibility}">
                    <Ellipse x:Name="LoadingDot1" Style="{StaticResource LoadingEllipseStyle}"/>
                    <Ellipse x:Name="LoadingDot2" Style="{StaticResource LoadingEllipseStyle}"/>
                    <Ellipse x:Name="LoadingDot3" Style="{StaticResource LoadingEllipseStyle}"/>
                </StackPanel>
            </StackPanel>

            <!-- 状态文本区域 -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,8,0">
                <TextBlock Text="{Binding Title}"
                           Style="{StaticResource StatusTitleStyle}"
                           Visibility="{Binding TitleVisibility}"/>

                <TextBlock Text="{Binding Message}"
                           Style="{StaticResource StatusMessageStyle}"
                           Visibility="{Binding MessageVisibility}"/>

                <TextBlock Text="{Binding Details}"
                           Style="{StaticResource StatusDetailsStyle}"
                           Visibility="{Binding DetailsVisibility}"/>

                <!-- 时间戳显示 -->
                <TextBlock Text="{Binding TimestampText}"
                           Style="{StaticResource StatusDetailsStyle}"
                           Visibility="{Binding TimestampVisibility}"/>
            </StackPanel>

            <!-- 操作按钮区域 -->
            <StackPanel Grid.Column="2"
                       Orientation="Horizontal"
                       VerticalAlignment="Center"
                       Visibility="{Binding ActionButtonVisibility}">

                <!-- 主要操作按钮 -->
                <Button x:Name="ActionButton"
                        Content="{Binding ActionButtonText}"
                        Command="{Binding ActionCommand}"
                        Visibility="{Binding ActionButtonVisibility}"
                        Style="{DynamicResource PrimaryButtonStyle}"
                        Padding="8,4"
                        FontSize="12"
                        Margin="4,0"/>

                <!-- 次要操作按钮 -->
                <Button x:Name="SecondaryButton"
                        Content="{Binding SecondaryButtonText}"
                        Command="{Binding SecondaryCommand}"
                        Visibility="{Binding SecondaryButtonVisibility}"
                        Style="{DynamicResource SecondaryButtonStyle}"
                        Padding="8,4"
                        FontSize="12"
                        Margin="4,0"/>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>